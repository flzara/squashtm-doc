<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Squash Team">
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Attachments repository - Squash TM Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Attachments repository";
    var mkdocs_page_input_path = "installation/attachments-repo.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Squash TM Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Installation Guide</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../requirements-prerequisites/">System requirements and prerequisites</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Installing Squash TM</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../squash-tm-installation/Squash-tm-1.13-install/">Squash TM 1.13+ installation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../squash-tm-installation/windows-installation/">Installation with Windows</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../running-stopping-squash-tm/">Running and stopping Squash TM</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Attachments repository</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#extracting-the-existing-attachments">Extracting the existing attachments</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#process-on-windows">Process on Windows</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#process-on-linux">Process on Linux</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#post-migration">Post-migration</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Administrator Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../administration/administration-page/">Administration page</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">User's Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../user/business-terminology/">Reader's guide: business terminology</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Developer's Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../developer/how-to-contribute/">How to contribute ?</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developer/css-guidelines/">CSS Guidelines</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developer/useful-css-classes/">Useful CSS Classes</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">FAQ</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../faq/faq-import-requirements/">How to import requirements ?</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Squash TM Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Installation Guide &raquo;</li>
        
      
    
    <li>Attachments repository</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/flzara/squashtm-doc/edit/master/docs/installation/attachments-repo.md"> Edit on flzara/squashtm-doc</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="attachments-repository">Attachments repository</h1>
<p>From Squash TM 1.18.0 release, it was made possible to store attachments outside the database directly in a file system. By default, the storage of attachments remains within the database because this is the simplest solution, and because it fits standard data quantities perfectly.</p>
<p>For a new installation of Squash TM, only a configuration is necessary for you to benefit from this new means of storage.
On an existing instance, you will first need to extract the existing attachments before you change the configuration.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Changing from a storage in a database to a file storage does have consequences, more specifically concerning data back-ups. The system administrator therefore absolutely needs to make the necessary modifications as follows:
- make sure you think of an attachment back-up system which works simultaneously with the database system
- make sure you have enough space to store the attachments and follow the evolution of this space
- give the right to read and write to the user launching the Squash TM process on the repository you picked to store the attachments</p>
</div>
<h2 id="configuration">Configuration</h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you already have existing attachements in a database, you absolutely need to extract them BEFORE you change the Squash TM configuration.</p>
</div>
<p><code>~SQUASH</code> is the deployment repository of Squash TM</p>
<ol>
<li>Stop Squash and edit the file squash.tm.cfg.properties within the ~SQUASH/conf repository</li>
<li>Add the squashtm.feature.file.repository = true attribute</li>
<li>Optionally, add the attribute squash.path.file.repository=<Chosen path for the repository storage>. This step is necessary after the database attachments were extracted. By default, if this attribute is absent, Squash TM will store the attachments within the ~SQUASH/attachments repository</li>
<li>Make all necessary system modifications, especially of the chosen path is not the default path (this targets more specifically the attribution of rights to the user, who needs to be allowed to write and edit the processes not only from the side of Squash, but also from the side of the machine)</li>
<li>Relaunch Squash TM</li>
<li>Make a test from the application by downloading an existing attachment. Add a new attachment, download it, and then erase it</li>
</ol>
<h2 id="extracting-the-existing-attachments">Extracting the existing attachments</h2>
<p>If you decide to change from a database storage to a file system storage on an existing Squash TM installation, you need to migrate the attachments from your database towards the file format supported by Squash TM.</p>
<p>A migration tool made by Henix is available at : http://repo.squashtest.org/distribution</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
</div>
<p>Save your database BEFORE you start the migration procedure, so as to still be able to restore it in case you should have a problem</p>
<h3 id="process-on-windows">Process on Windows</h3>
<ol>
<li>Stop Squash TM</li>
<li>Unzip the tool. If you wish to keep the default attachement storing path, you may directly unzip the tool in the Squash TM root repository and not change REPO_PATH. Your attachements will be directly put in your file (~SQUASH/squash-tm-extract-attachment-tool/attachments)</li>
<li>Edit the file extract-attachment.bat</li>
<li>Find the following lines:
   <code>shell
    set DB_TYPE=h2
    set DB_URL=jdbc:h2:./data/squash-tm
    set DB_USERNAME=sa
    set DB_PASSWORD=sa</code>
    Edit with the needed values to access the database of your Squash TM instance. They should all be similar to the ones in your Squash TM startup script.</li>
<li>Find the following line:
          REPO_PATH=./attachments
   Edit path if necessary. The attachments will be extracted in this repository.</li>
<li>Run the file extract-attachment.bat
    The migration starts automatically. It involves three steps:<ul>
<li>the extraction of the attachments</li>
<li>the verification of the extracted files</li>
<li>the deletion of the attachements in the database</li>
</ul>
</li>
<li>Once the migration is finished, please configure Squash TM as indicated in section 6.1</li>
</ol>
<h3 id="process-on-linux">Process on Linux</h3>
<ol>
<li>Stop Squash TM</li>
<li>Unzip the tool. If you wish to keep the default attachement storing path, you may directly unzip the tool in the Squash TM root repository and not change REPO_PATH. Your attachements will be directly put in your file (~SQUASH/attachments)</li>
<li>Edit the file extract-attachment.sh</li>
<li>Find the following lines:
   <code>sql 
    DB_TYPE=h2
    DB_URL=jdbc:h2:../data/squash-tm
    DB_USERNAME=sa
    DB_PASSWORD=sa</code>
    Edit with the needeed values to access the database of your Squash TM instance. They should all be similar to the ones in your Squash TM startup script.</li>
<li>Find the following line: REPO_PATH=./attachments
   Edit path if necessary. The attachments will be extracted in this repository.</li>
<li>Run the file extract-attachment.sh
   The migration starts automatically. It involves three steps:<ul>
<li>the extraction of the attachments</li>
<li>the verification of the extracted files</li>
<li>the deletion of the attachements in the database</li>
</ul>
</li>
<li>Once the migration is finished, please configure Squash TM as indicated in section 6.1</li>
</ol>
<h3 id="post-migration">Post-migration</h3>
<p>Depending on the RDBMS, you might need to maintain the database to free the disk space the attachments take, even if the migrator deleted them by means of SQL requests. For instance, vacuumlo or vaccumdb for the PostgreSQL database, or to execute an «optimize table» from the Table Inspector for the MySQL database. 
Please see the documentation regarding your RDBMS for more information.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../administration/administration-page/" class="btn btn-neutral float-right" title="Administration page">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../running-stopping-squash-tm/" class="btn btn-neutral" title="Running and stopping Squash TM"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2011 - 2021 Henix</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../running-stopping-squash-tm/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../administration/administration-page/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
